<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Time Tracker</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="style.css">
</head>
<body>


	<div class="container" id="tracker-app" style="display: none" :style="{display:'block'}">
		<div class="row">
			<div class="col py-5">
				<h1 class="text-center mb-4">Time Tracker</h1>

				<div class="modals">
					<div class="modals__wrapper">
						<div class="modals__item  task-adding" id="task-adding">
							<div class="task-adding__wrapper">
								<div class="modals__close" onclick="modalClose(event)">&times;</div>
								<h2 class="text-center">Новый проект/задача</h2>
								<form action="" @submit.prevent="addProject();" class="form pt-4">
									
									<div class="form-group">
										<label for="exampleInputEmail1">Название задачи/проекта</label>
										<input type="text" ref="new_title" name="title" class="form-control mb-2" required placeholder="Сверстать лендинг" autocomplete="off">
									</div>

									<div class="form-group">
										<label for="exampleInputEmail1">Описание задачи/проекта</label>
										<input type="text" ref="new_desc" name="desc" class="form-control mb-2" placeholder="Выполнить внезапно и очень быстро" autocomplete="off">
									</div>
									
									<div class="form-group">
										<label for="exampleInputEmail1">Почасовая ставка</label>
										<!-- <input type="number" ref="new_rate" :value="rate" name="rate" class="form-control" autocomplete="off"> -->
										<input type="number" ref="new_rate" value="400" name="rate" class="form-control" autocomplete="off">
									</div>

									<button class="btn btn-block btn-primary">Добавить задачу</button>
								</form>
							</div>
						</div>
						<div class="modals__bg" onclick="modalClose(event)"></div>
					</div>
				</div> <!-- /.modals -->

				<!-- <pre>{{this.tasks}}</pre> -->

				<div class="text-right mb-4 pb-2">
					<button onclick="modalOpen(event, '#task-adding')" class="btn btn-outline-primary">Добавить задачу / проект</button>
				</div>

				<div class="alert p-relative" v-for="(task, task_id) in tasks" :class="'alert-'+task.status">

					<div class="d-flex justify-content-between pb-3">
						<i class="mr-3">{{statuses[task.status]}}</i>
						<button class="close" @click="remove(task_id)" data-toggle="tooltip" data-title="Удалить задачу">
							<span>&times;</span>
						</button>
					</div>
					
					<h4 class="alert-heading pr-3">{{task.title}}</h4>
					
					<p class="m-0">{{task.desc}}</p>
					
					<div class="times pt-3 list-group" v-if="task.times.length && task.show_times">
						
						<div class="times pt-3 list-group">
							<div	class="times-item list-group-item list-group-item-action"
									v-for="(time, key) in task.times"
									:class="{'active':task.times.length-1==key}"
									>
								<div class="d-flex w-100 justify-content-between">
									<h5 class="mb-1">{{time.title||'Название подзадачи/шага'}}</h5>
									<small>{{(getSpendeingTime(time.start,time.end))}}</small>
								</div>
								<p class="mb-0">{{time.comment}}</p>
								<div v-if="task.times.length-1==key && task.status!='secondary' && task.status!='success'" class="pt-3">
									<button @click="switchStatus(task_id, 'secondary')" class="btn btn-secondary">Поставить на паузу</button>
									<button @click="switchStatus(task_id, 'success')" class="btn btn-success">Завершить</button>
								</div>
							</div>
						</div>
						
						<div v-if="task.status != 'success'" class="pt-3 text-center">
							<button @click="switchStatus(task_id, 'primary')" v-if="task.status != 'primary'" class="btn btn-primary">Продолжить</button>
	
							<button @click="switchStatus(task_id, 'secondary')" v-if="task.times.length && task.status != 'secondary'" class="btn btn-secondary">Поставить на паузу</button>
							<button @click="switchStatus(task_id, 'success')" v-if=" task.status != 'light'" class="btn btn-success">Завершить</button>
						</div>
						<div v-if="task.status == 'success'" class="pt-3">
							<button @click="switchStatus(task_id, 'primary')" class="btn btn-primary">Вернуть в работу</button>
						</div>

						<table class="table table-striped rounded mt-3">
							<tr>
								<th class="text-right">Часы:</th>
								<td class="pl-1">{{getProcessInfo(task).hours}}</td>
							</tr>
							<tr>
								<th class="text-right">Минуты:</th>
								<td class="pl-1">{{getProcessInfo(task).minutes}}</td>
							</tr>
							<tr>
								<th class="text-right">Стоимость:</th>
								<td class="pl-1">{{getProcessInfo(task).money}}₽</td>
							</tr>
							<tr>
								<th class="text-right">Почасовая ставка:</th>
								<td class="pl-1">{{task.rate}}</td>
							</tr>
							<tr v-if="task.times.length">
								<th class="text-right">Начало работы:</th>
								<td class="pl-1">{{getStringifyDate(task.times[0].start)}}</td>
							</tr>
							<tr v-if="task.times.length && task.times[task.times.length-1].end">
								<th class="text-right" v-if="task.status == 'success'">Завершено:</th>
								<th class="text-right" v-else>Приостановлено:</th>
								<td class="pl-1">{{getStringifyDate(task.times[task.times.length-1].end)}}</td>
							</tr>
						</table>
					</div>
					
					<div class="pt-2" v-if="task.times.length">
						<a href="#" class="link" v-if="!task.show_times" @click.prevent="task.show_times=!0">&equiv; Показать информацию</a>
						<a href="#" class="link" v-if="task.show_times" @click.prevent="task.show_times=!1">&times; Свернуть информацию</a>
					</div>
					<div class="pt-2" v-if="!task.times.length">
						<button @click="switchStatus(task_id, 'primary')" class="btn btn-primary">Начать</button>
					</div>
				</div>

				<div v-if="!tasks.length">
					<div class="alert alert-info">
				
						<h4 class="alert-heading">Нет открытых задач</h4>
						
						<p class="m-0">
							<a href="#" onclick="modalOpen(event, '#task-adding')">Добавьте задачу / проект</a>, чтобы контролировать время, трачимое на нее.
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>

<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script src="scripts.js"></script>
</body>
</html>